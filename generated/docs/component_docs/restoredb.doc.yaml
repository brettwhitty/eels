---
# Ergatis Component Documentation
# Extracted from source by extract_component_docs.pl
# Source: TIGR/JCVI/IGS Ergatis bioinformatics workflow system
#
# This file preserves ALL documentation, comments, parameter descriptions,
# and structural details from the original Ergatis source files.

component: restoredb
extracted_at: "2026-02-19T15:39:25"
source_files:
  - restoredb.config
  - restoredb.xml
  - workflow/restoredb-master.ini
  - workflow/restoredbconf.ini

# Configuration file - all sections, parameters, defaults, and inline comments
config:
  interface:
    classification: database / loading
  parameters:
    DATABASE: ""
    SERVER: SYBTIGR
    DATABASE_TYPE: sybase
    BATCHSIZE: 30000
    BCP_EXTENSION: out
  input:
    BCP_DIR: ""
    # This input file list should be a file containing a new-line separated list of BCP files
    INPUT_FILE_LIST: ""
    # This input file value should be a comma-separated list of BCP files
    INPUT_FILE: ""
    # This input directory value should the fullpath to a directory containing BCP files
    INPUT_DIRECTORY: ""
  output:
    OUTPUT_TOKEN: default
    OUTPUT_DIRECTORY: $;TMP_DIR$;
  component:
    COMPONENT_NAME: restoredb
    WORKFLOW_REPOSITORY: $;REPOSITORY_ROOT$;/workflow/runtime/$;COMPONENT_NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    PIPELINE_TOKEN: unnamed
    # The version,revision,tag here is set by an interpolated CVS tag
    VERSION: 2.0
    RELEASE_TAG: $Name$
    REVISION: $Revision$
    TEMPLATE_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.xml
    ITERATOR1: sqlforce
    ITERATOR1_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.$;ITERATOR1$;.xml
    ITERATOR2: sql
    ITERATOR2_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.$;ITERATOR2$;.xml
    ITERATOR3: load_bcp
    ITERATOR3_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.$;ITERATOR3$;.xml
    # Distributed options
    GROUP_COUNT: 1
    # no-distrib = 0 ensures that all executes in series and never parallel
    NODISTRIB: 0
    # the following keys are replaced at runtime by the invocation script
    COMPONENT_CONFIG: ""
    COMPONENT_XML: ""
    PIPELINE_XML: ""
    PIPELINEID: ""
  include:
    PROJECT_CONFIG: ""

# Main workflow XML template - step definitions
workflow_xml:
  xml_comments:
    - Preprocessing
    - Iterator1 for dropping all chado-mart tables
    - Iterator2 for dropping all chado tables
    - Iterator3 for creating all chado tables
    - Iterator4 for creating all views
    - Iterator5 for partitioning appropriate chado tables
    - Iterator6 load all BCP files
    - Iterator7 for creating all indices and constraints
    - Iterator8 for granting all permissions on all chado tables
  command_sets:
    - initdb workflow
  includes:
    - "file=\"$;DOCS_DIR$;/iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=drop_views,$;ITERATOR_XML$;=ITERATOR1_XML,$;ITERATOR_LIST$;=$;TMP_DIR$;/drop_views.list,$;NODISTRIB$;=1\"/"
    - "file=\"$;DOCS_DIR$;/iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=drop_tables,$;ITERATOR_XML$;=ITERATOR1_XML,$;ITERATOR_LIST$;=$;TMP_DIR$;/drop_tables.list,$;NODISTRIB$;=1\"/"
    - "file=\"$;DOCS_DIR$;/iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=create_tables,$;ITERATOR_XML$;=ITERATOR2_XML,$;ITERATOR_LIST$;=$;TMP_DIR$;/create_tables.list,$;NODISTRIB$;=1\"/"
    - "file=\"$;DOCS_DIR$;/iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=create_views,$;ITERATOR_XML$;=ITERATOR2_XML,$;ITERATOR_LIST$;=$;TMP_DIR$;/create_views.list,$;NODISTRIB$;=1\"/"
    - "file=\"$;DOCS_DIR$;/iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=partition_tables,$;ITERATOR_XML$;=ITERATOR2_XML,$;ITERATOR_LIST$;=$;TMP_DIR$;/partition_tables.list,$;NODISTRIB$;=1\"/"
    - "file=\"$;DOCS_DIR$;/iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=load_tables,$;ITERATOR_XML$;=ITERATOR3_XML,$;ITERATOR_LIST$;=$;WORKFLOW_REPOSITORY$;/bcp_file.list,$;NODISTRIB$;=1\"/"
    - "file=\"$;DOCS_DIR$;/iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=create_indexes,$;ITERATOR_XML$;=ITERATOR2_XML,$;ITERATOR_LIST$;=$;TMP_DIR$;/create_indexes.list,$;NODISTRIB$;=1\"/"
    - "file=\"$;DOCS_DIR$;/iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=grant_all_public,$;ITERATOR_XML$;=ITERATOR2_XML,$;ITERATOR_LIST$;=$;TMP_DIR$;/grant_all_public.list,$;NODISTRIB$;=1\"/"
  steps:
    - name: create output directory
      type: RunUnixCommand
      executable: mkdir
      arg: -p -m 777 $;OUTPUT_DIRECTORY$;
    - name: create temp directory
      type: RunUnixCommand
      executable: mkdir
      arg: -p -m 777 $;TMP_DIR$;
    - name: Drop views list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/ddl2iterator
      params:
        - key: stdin
          value: $;DOCS_DIR$;/drop_views.ddl
        - key: stdout
          value: $;TMP_DIR$;/drop_views.list
    - name: Drop tables list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/ddl2iterator
      params:
        - key: stdin
          value: $;DOCS_DIR$;/drop_tables.ddl
        - key: stdout
          value: $;TMP_DIR$;/drop_tables.list
    - name: Create tables list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/ddl2iterator
      params:
        - key: stdin
          value: $;DOCS_DIR$;/create_tables.ddl
        - key: stdout
          value: $;TMP_DIR$;/create_tables.list
    - name: Create views list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/ddl2iterator
      params:
        - key: stdin
          value: $;DOCS_DIR$;/create_views.ddl
        - key: stdout
          value: $;TMP_DIR$;/create_views.list
    - name: Partition tables
      type: RunUnixCommand
      executable: $;BIN_DIR$;/ddl2iterator
      params:
        - key: stdin
          value: $;DOCS_DIR$;/partition_tables.ddl
        - key: stdout
          value: $;TMP_DIR$;/partition_tables.list
    - name: create_file_iterator_list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/create_file_iterator_list
      params:
        - key: --input_file
          value: $;INPUT_FILE$;
        - key: --input_file_list
          value: $;INPUT_FILE_LIST$;
        - key: --input_directory
          value: $;INPUT_DIRECTORY$;
        - key: --input_directory_extension
          value: $;BCP_EXTENSION$;
        - key: --output_iter_list
          value: $;WORKFLOW_REPOSITORY$;/bcp_file.list
    - name: Create indexes list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/ddl2iterator
      params:
        - key: stdin
          value: $;DOCS_DIR$;/create_indexes.ddl
        - key: stdout
          value: $;TMP_DIR$;/create_indexes.list
    - name: Grant all permissions list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/ddl2iterator
      params:
        - key: stdin
          value: $;DOCS_DIR$;/grant_all_public.ddl
        - key: stdout
          value: $;TMP_DIR$;/grant_all_public.list

# Workflow INI: restoredb-master.ini
workflow_ini_restoredb-master.ini:
  create_indices:
    # 
    param.command: $;BIN_DIR$;/sql2Chado
    param.--username: chado_admin
    param.--password: chado_admin99
    param.--database: $;DATABASE$;
    param.--server: $;SERVER$;
    param.--action: createindexes
    param.--testmode: $;SKIP_LOAD$;
    param.--indexmanip: $;REFRESH_INDEXES$;
    param.--debug_level: $;DEBUG$;
    param.--file: $;CHADO_SCHEMA_VERSION$;/docs/create_indexes.ddl
    param.--database_type: $;DATABASE_TYPE$;
    param.--log4perl: $;WORKFLOW_REPOSITORY$;/create_indices/sql2Chado.pl.log
    param.stdout: $;WORKFLOW_REPOSITORY$;/create_indices/sql2Chado.pl.stdout
    param.stderr: $;WORKFLOW_REPOSITORY$;/create_indices/sql2Chado.pl.stderr
  create_tables:
    # 
    param.command: $;BIN_DIR$;/sql2Chado
    param.--username: chado_admin
    param.--password: chado_admin99
    param.--database: $;DATABASE$;
    param.--action: createtables
    param.--file: $;CHADO_SCHEMA_VERSION$;/docs/create_tables.ddl
    param.--server: $;SERVER$;
    param.--database_type: $;DATABASE_TYPE$;
    param.--log4perl: $;WORKFLOW_REPOSITORY$;/create_tables/sql2Chado.pl.log
    param.stdout: $;WORKFLOW_REPOSITORY$;/create_tables/sql2Chado.pl.stdout
    param.stderr: $;WORKFLOW_REPOSITORY$;/create_tables/sql2Chado.pl.stderr
  drop_tables:
    # 
    param.command: $;BIN_DIR$;/dropchadoobjects
    param.--username: chado_admin
    param.--password: chado_admin99
    param.--database: $;DATABASE$;
    param.--object_type: tables
    param.--server: $;SERVER$;
    param.--database_type: $;DATABASE_TYPE$;
    param.--log4perl: $;WORKFLOW_REPOSITORY$;/drop_tables/dropchadoobjects.pl.log
    param.stdout: $;WORKFLOW_REPOSITORY$;/drop_tables/dropchadoobjects.pl.stdout
    param.stderr: $;WORKFLOW_REPOSITORY$;/drop_tables/dropchadoobjects.pl.stderr
  empty:
  grant_permissions:
    # 
    param.command: $;BIN_DIR$;/sql2Chado
    param.--username: chado_admin
    param.--password: chado_admin99
    param.--database: $;DATABASE$;
    param.--action: grantallpublic
    param.--file: $;CHADO_SCHEMA_VERSION$;/docs/grant_all_public.ddl
    param.--server: $;SERVER$;
    param.--database_type: $;DATABASE_TYPE$;
    param.--log4perl: $;WORKFLOW_REPOSITORY$;/grant_permissions/sql2Chado.pl.log
    param.stdout: /$;WORKFLOW_REPOSITORY$;/grant_permissions/sql2Chado.pl.stdout
    param.stderr: /$;WORKFLOW_REPOSITORY$;/grant_permissions/sql2Chado.pl.stderr
  load_tables:
    # 
    param.command: $;BIN_DIR$;/bcptochado
    param.--username: chado_admin
    param.--password: chado_admin99
    param.--database: $;DATABASE$;
    param.--server: $;SERVER$;
    param.--bcpmode: in
    param.--batchsize: 30000
    param.--directory: $;OUTPUT_DIRECTORY$;
    param.--abort: 0
    param.--debug_level: $;DEBUG$;
    param.--testmode: $;SKIP_LOAD$;
    param.--ignore_empty_bcp: 1
    param.--gzip_bcp: $;GZIP_BCP$;
    param.--database_type: $;DATABASE_TYPE$;
    param.--logfile: $;WORKFLOW_REPOSITORY$;/load_tables/bcptochado.pl.log
    param.stdout: $;WORKFLOW_REPOSITORY$;/load_tables/bcptochado.pl.stdout
    param.stderr: $;WORKFLOW_REPOSITORY$;/load_tables/bcptochado.pl.stderr
  mkdir_compute_scratch:
    # 
    param.command: mkdir
    arg: -p -m 777 $;OUTPUT_DIRECTORY$;
  mkdir_create_indices:
    # 
    param.command: mkdir
    arg: -p -m 777 $;WORKFLOW_REPOSITORY$;/create_indices
  mkdir_create_tables:
    # 
    param.command: mkdir
    arg: -p -m 777 $;WORKFLOW_REPOSITORY$;/create_tables
  mkdir_drop_tables:
    # 
    param.command: mkdir
    arg: -p -m 777 $;WORKFLOW_REPOSITORY$;/drop_tables
  mkdir_grant_permissions:
    # 
    param.command: mkdir
    arg: -p -m 777 $;WORKFLOW_REPOSITORY$;/grant_permissions
  mkdir_load_tables:
    # 
    param.command: mkdir
    arg: -p -m 777 $;WORKFLOW_REPOSITORY$;/load_tables
  mkdir_partition_tables:
    # 
    param.command: mkdir
    arg: -p -m 777 $;WORKFLOW_REPOSITORY$;/partition_tables
  mkdir_revoke_permissions:
    # 
    param.command: mkdir
    arg: -p -m 777 $;WORKFLOW_REPOSITORY$;/revoke_permissions
  partition_tables:
    # 
    param.command: $;BIN_DIR$;/sql2Chado
    param.--username: chado_admin
    param.--password: chado_admin99
    param.--database: $;DATABASE$;
    param.--action: partitiontables
    param.--file: $;CHADO_SCHEMA_VERSION$;/docs/partition_tables.ddl
    param.--server: $;SERVER$;
    param.--database_type: $;DATABASE_TYPE$;
    param.--log4perl: $;WORKFLOW_REPOSITORY$;/partition_tables/sql2Chado.pl.log
    param.stdout: /$;WORKFLOW_REPOSITORY$;/partition_tables/sql2Chado.pl.stdout
    param.stderr: /$;WORKFLOW_REPOSITORY$;/partition_tables/sql2Chado.pl.stderr
  revoke_permissions:
    # 
    param.command: $;BIN_DIR$;/sql2Chado
    param.--username: chado_admin
    param.--password: chado_admin99
    param.--database: $;DATABASE$;
    param.--action: revokeallpublic
    param.--file: $;WORKFLOWDOCS_DIR$;/revoke_all_public.ddl
    param.--server: $;SERVER$;
    param.--database_type: $;DATABASE_TYPE$;
    param.--log4perl: $;WORKFLOW_REPOSITORY$;/revoke_permissions/sql2Chado.pl.log
    param.stdout: /$;WORKFLOW_REPOSITORY$;/revoke_permissions/sql2Chado.pl.stdout
    param.stderr: /$;WORKFLOW_REPOSITORY$;/revoke_permissions/sql2Chado.pl.stderr

# Workflow INI: restoredbconf.ini
workflow_ini_restoredbconf.ini:
  _header:
    # configuration file for the restoredb workflow
  include restoredb:
    $;SHARED_CONFIG$;: ""
  input restoredb:
    $;INPUT_DIRECTORY$;: ""
  output restoredb:
    $;OUTPUT_TOKEN$;: default
    $;OUTPUT_DIRECTORY$;: $;REPOSITORY_ROOT$;/output_repository/$;NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
  parameters restoredb:
    $;EMAIL$;: ""
    $;SERVER$;: ""
    # 1 or 0
    $;IS_BCP_GZIP$;: 1
    # assume the current schema is desired
    $;CHADO_SCHEMA_VERSION$;: $;ERGATIS_DIR$;
    # postgresql or sybase
    $;DATABASE_TYPE$;: ""
  workflowdocs restoredb:
    # The version here is set by an interpolated CVS tag
    $;VERSION$;: $Name$
    $;REVISION$;: $Revision$
    $;TAG$;: $Name$
    $;NAME$;: restoredb
    $;MASTER_TEMPLATE_INI$;: $;WORKFLOWDOCS_DIR$;/restoredb-master.ini
    $;MASTER_TEMPLATE_XML$;: $;WORKFLOWDOCS_DIR$;/restoredb-master_template.xml
    $;WORKFLOW_REPOSITORY$;: $;REPOSITORY_ROOT$;/Workflow/$;NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    $;GROUP_COUNT$;: 400
    # the following keys are replaced at runtime by the invocation script
    $;COMPONENT_CONFIG$;: ""
    $;NODISTRIB$;: 0

# Perl script documentation (POD)
perl_scripts:
  - script: create_file_iterator_list.pl
    pod: |
  =head1  NAME 
  
  create_file_iterator_list.pl - generates list file from various input sources of filenames.
  
  =head1 SYNOPSIS
  
  USAGE: create_file_iterator_list.pl 
          --input_file_list=/path/to/some.list
          --input_file=/path/to/somefile.fsa
          --input_directory=/path/to/some/dir
          --input_directory_extension=fsa
          [--checksum_filenames=1
          --log=/path/to/some.log
          --debug=4 ]
  
  =head1 OPTIONS
  
  B<--input_file_list,-l> 
      a plain text file containing the full paths to any number of files, one per line.  
      this can also be a comma-separated list of input file lists.
  
  B<--input_file,-f> 
      the full path to an input file. this can also be a comma-separated list of 
      input files.
  
  B<--input_directory,-d> 
      the full path to an input directory. this can also be a comma-separated list of 
      input directories.
  
  B<--input_directory_extension,-x> 
      to be used in conjuction with the input_directory option, this can be used to
      filter files by extension within any passed input directories.
  
  B<--output_iterator_list,-o>
      output file. Up to 7 lines with comma separated lists of limits
  
  B<--output_iterator_list,-o>
      comma separated list of iterator keys used in the output file.  Each key will be a separate line in the output file.  There are 7 lines in the output file listing FILE, FILE_NAME, FILE_BASE, FILE_EXT, DIRECTORY, XML file
  
  B<--checksum_filenames> 
      use checksums instead of the basename as the iterator name. The checksum will be based on the full path to the file.
  
  B<--log> 
      optional.  path to a log file the script should create.  will be overwritten if
      already exists.
      
  B<--debug> 
      optional.  the debug level for the logger (an integer)
  
  B<--help,-h> 
      This help message/documentation.
  
  =head1   DESCRIPTION
  
      This script is used to accept a selection of inputs from either an input list, 
      directory, file, or any combination thereof.  Each of these options can also
      be specified using comma-separated lists.  These inputs will then be distributed
      randomly across a certain number of groups, specified using the --group_count
      option (usually somewhere around 150).
      
      To prevent too many files from being directly in one group, additional groups are 
      automatically created for large input sets.  You can control how many inputs are 
      in a group before another is created using the --group_size_limit option (default 
      1000).  Once the number of inputs in any group reaches this number, another group 
      is created until it is full, and so on.
  
  =head1   OUTPUT
  
      The location of the output is specified using the --output_directory option.  One
      numbered directory will be created under this for each group needed.
      
      MORE OUTPUT DESCRIPTIONS NEEDED
      
  =head1 CONTACT
  
      Joshua Orvis
      jorvis@tigr.org
