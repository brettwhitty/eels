---
# Ergatis Component Documentation
# Extracted from source by extract_component_docs.pl
# Source: TIGR/JCVI/IGS Ergatis bioinformatics workflow system
#
# This file preserves ALL documentation, comments, parameter descriptions,
# and structural details from the original Ergatis source files.

component: gff2bsml
extracted_at: "2026-02-19T15:39:25"
source_files:
  - workflow/gff2bsml-master.ini
  - workflow/gff2bsml.ini
  - workflow/gff2bsmlconf.ini

# Workflow INI: gff2bsml-master.ini
workflow_ini_gff2bsml-master.ini:
  check_logfiles:
    param.command: $;BIN_DIR$;/check_logfiles
    param.--debug_level: 5
    param.--log4perl: $;TMP_DIR$;/check_logfiles.pl.log
    param.--username: "'$;EMAIL$;'"
    param.--workflow_id: $;REPOSITORY_ROOT$;/Workflow/pipeline/$;PIPELINEID$;/pipeline.xml.instance
    param.--repository: $;WORKFLOW_REPOSITORY$;
    param.--project: $;DATABASE$;
    param.--component: $;NAME$;
  create_bsml_list_file:
    param.command: find
    arg: "$;OUTPUT_DIRECTORY$; -name '*.bsml'"
    param.stdout: $;OUTPUT_DIRECTORY$;/$;NAME$;.bsml.list
  create_compute_output:
    # 
    # make the output directory
    param.command: mkdir
    arg: -p -m 777 $;OUTPUT_DIRECTORY$;
  create_compute_scratch:
    # 
    # make the scratch space
    param.command: mkdir
    arg: -p -m 777 $;TMP_DIR$;
  create_fasta_list_file:
    param.command: find
    arg: "$;FASTADIR$; -name '*.fsa'"
    param.stdout: $;FASTADIR$;/$;NAME$;.fsa.list
  create_fastadir:
    # make the fasta directory
    param.command: mkdir
    arg: -p -m 777 $;FASTADIR$;
  create_groups_subflow1:
    # 
    # 
    param.command: $;BIN_DIR$;/generate_groups
    param.output_dir: $;WORKFLOW_REPOSITORY$;
    param.prefix: subflow1groups
    param.group_count: $;GROUP_COUNT$;
    param.file: $;WORKFLOW_REPOSITORY$;/subflow1.list
  create_iterative_subflow1:
    # 
    # create iterative subflow
    param.command: $;BIN_DIR$;/generate_subflow
    # workflow doc information
    param.template: $;WORKFLOWDOCS_DIR$;/groups-iterator_template.xml
    param.inifile: $;WORKFLOWDOCS_DIR$;/groups-iterator.ini
    param.iteratortemplate: $;WORKFLOWDOCS_DIR$;/batch-paralleliterator_template.xml
    param.iteratorini: $;WORKFLOWDOCS_DIR$;/batch-iterator.ini
    param.iteratorlist: $;WORKFLOW_REPOSITORY$;/subflow1groups.list
    param.conf: $;COMPONENT_CONFIG$;
    param.wfname: $;NAME$;
    param.nodistrib: $;NODISTRIB$;
    # output information
    param.outputdir: $;WORKFLOW_REPOSITORY$;
    param.outputxml: $;WORKFLOW_REPOSITORY$;/groups.xml
    param.debug: $;DEBUG$;
  create_iterator_list_subflow1:
    # 
    # 
    param.command: $;BIN_DIR$;/generate_input_list
    param.filelist: "'$;INPUT_FILE_LIST$;'"
    param.file: "'$;INPUT_FILE$;'"
    param.directory: "'$;INPUT_DIRECTORY$;'"
    param.extension: "'$;INPUT_EXTENSION$;'"
    param.output: $;WORKFLOW_REPOSITORY$;/subflow1.list
  empty:
  subflow1:
    # 
    # 
    fileName: $;WORKFLOW_REPOSITORY$;/groups.xml

# Workflow INI: gff2bsml.ini
workflow_ini_gff2bsml.ini:
  add_translation_table:
    param.command: $;BIN_DIR$;/add_translation_table
    param.log4perl: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.add_translation_table.pl.log
    param.debug_level: $;DEBUG$;
    param.outdir: $;OUTPUT_DIRECTORY$;
    param.gff_file: $;ITER_FILE_PATH$;
    param.stdout: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.add_translation_table.stdout
    param.stderr: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.add_translation_table.stderr
  clean_fasta_section:
    param.command: $;BIN_DIR$;/clean_fasta_section
    param.log4perl: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.clean_fasta_section.pl.log
    param.debug_level: $;DEBUG$;
    param.outdir: $;OUTPUT_DIRECTORY$;
    param.gff_file: $;ITER_FILE_PATH$;
    param.stdout: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.clean_fasta_section.stdout
    param.stderr: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.clean_fasta_section.stderr
  empty:
  gff2bsml:
    param.command: $;BIN_DIR$;/gff2bsml
    param.log4perl: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.gff2bsml.pl.log
    param.debug_level: $;DEBUG$;
    param.outdir: $;OUTPUT_DIRECTORY$;
    param.fastadir: $;FASTADIR$;
    param.gff_file: $;ITER_FILE_PATH$;
    param.--id_repository: $;PROJECT_ID_REPOSITORY$;
    param.stdout: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.gff2bsml.stdout
    param.stderr: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.gff2bsml.stderr
  validate_gff3:
    param.command: /usr/local/devel/ANNOTATION/brc-central/gff3Valid.pl2
    arg: $;ITER_FILE_PATH$;
    param.stdout: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.gff3Valid.stdout
    param.stderr: $;TMP_DIR$;/$;GROUP_NAME$;/$;ITER_FILE_BASE$;.gff3Valid.stderr

# Workflow INI: gff2bsmlconf.ini
workflow_ini_gff2bsmlconf.ini:
  _header:
    # configuration file for the gff2bsml workflow
  include gff2bsml:
    $;SHARED_CONFIG$;: ""
  input gff2bsml:
    # This parameter can be a single file (or a comma-separated list of such files) containing a new-line separated list of .bsml documents to be loaded
    $;INPUT_FILE_LIST$;: ""
    $;INPUT_FILE$;: ""
    $;INPUT_DIRECTORY$;: ""
    # the following is only used when iterating over an INPUT_DIRECTORY
    $;INPUT_EXTENSION$;: gff
  output gff2bsml:
    $;OUTPUT_TOKEN$;: default
    $;OUTPUT_DIRECTORY$;: $;REPOSITORY_ROOT$;/output_repository/$;NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    # Output directory for the associated nucleotide and protein fasta files
    $;FASTADIR$;: $;REPOSITORY_ROOT$;/output_repository/gff2bsml_fasta/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
  parameters gff2bsml:
    # To receive check_logfiles.pl notification once the workflow execution has completed.
    $;EMAIL$;: ""
  workflowdocs gff2bsml:
    # The version here is set by an interpolated CVS tag
    $;VERSION$;: $Name$
    $;REVISION$;: $Revision$
    $;TAG$;: $Name$
    $;NAME$;: gff2bsml
    $;MASTER_TEMPLATE_INI$;: $;WORKFLOWDOCS_DIR$;/gff2bsml-master.ini
    $;MASTER_TEMPLATE_XML$;: $;WORKFLOWDOCS_DIR$;/gff2bsml-master_template.xml
    $;TEMPLATE_INI$;: $;WORKFLOWDOCS_DIR$;/gff2bsml.ini
    $;TEMPLATE_XML$;: $;WORKFLOWDOCS_DIR$;/gff2bsml_template.xml
    $;WORKFLOW_REPOSITORY$;: $;REPOSITORY_ROOT$;/Workflow/$;NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    $;GROUP_COUNT$;: 150
    # the following keys are replaced at runtime by the invocation script
    $;COMPONENT_CONFIG$;: ""
    $;NODISTRIB$;: 0

# Perl script documentation (POD)
perl_scripts:
  - script: gff2bsml.pl
    pod: |
  =head1 NAME
  
  gff32bsml.pl - Convert GFF3 annotation data into BSML.
  
  =head1 SYNOPSIS
  
  gff32bsml.pl
           --input=/path/to/annotation.gff3
           --output=/path/to/results.bsml
           --project=rca1
           --id_repository=/usr/local/projects/rca1/workflow/project_id_repository
           --organism='Aspergillus nidulans'
          [--peptide_fasta=/path/to/peptide-seqs.fsa
           --peptide_id_regex='^>(\S+)'
           --peptide_id_prefix=''
           --peptide_id_suffix='-Protein'
           --peptide_no_seqdata
           --dna_fasta=/path/to/dna-seqs.fsa
           --dna_id_regex='^>(\S+)'
           --dna_id_prefix='Chr'
           --dna_id_suffix=''
           --dna_no_seqdata
           --gene_type=gene
           --organism_genetic_code=1
           --organism_mt_genetic_code=4
           --use_cds_parent_ids
           --insert_missing_mrnas
           --insert_missing_exons
           --insert_polypeptides
           --inserted_polypeptide_id_type=CDS
           --default_seq_class=assembly
           --default_seq_attributes='SO:contig'
           --feat_attribute_mappings='Name:gene_product_name,comment:comment'
           --clone_feat_attribute_mappings='gene:gene_product_name:transcript,gene:gene_product_name:CDS'
           --feat_xref_mappings='ID:mydb:accession,Name:mydb:pub_locus'
           --clone_feat_xref_mappings='gene:NCBILocus:transcript,gene:NCBILocus:CDS'
           --seq_xref_mappings='ID:mydb:seq_id'
           --atts_with_unescaped_commas='ID,Name'
           --allow_genes_with_no_cds
           --sofa_type_mappings='transcript=>CDS,ORF=>gene'
           --log=/path/to/some.log
           --debug=4
           --help
           --man ]
  
  =head1 OPTIONS
  
  B<--input, -g>
      path to the input GFF file.
  
  B<--peptide_fasta, -e>
      optional.  path to a multi-FASTA file containing the polypeptides for the genes in the GFF file.
      if this argument is supplied then the named file _must_ contain all the sequences for the 
      polypeptide/protein features in the input GFF file, _except_ those that appear in the ##FASTA
      section of the GFF file.
  
  B<--peptide_id_regex>
      optional.  regular expression used to parse peptide unique id from FASTA deflines in --peptide_fasta
      and the FASTA section of the GFF file itself.  in the latter case, the regular expression must NOT
      match any non-peptide ids, otherwise --peptide_id_prefix and --peptide_id_suffix may be misapplied.
      default = ^>(\S+)
  
  B<--peptide_id_prefix>
      optional. prefix to prepend to the id parsed by --peptide_id_regex to produce the polypeptide ID 
      used by the corresponding GFF feature.
  
  B<--peptide_id_suffix>
      optional. suffix to append to the id parsed by --peptide_id_regex to produce the polypeptide ID 
      used by the corresponding GFF feature.
  
  B<--peptide_no_seqdata>
      do not create Seq-data or Seq-data-import entries for the polypeptide sequences; use --peptide_fasta,
      if specified, only to determine the sequence length(s).
  
  B<--dna_fasta>
      optional.  path to a multi-FASTA file containing the DNA sequences for the reference sequences
      in the GFF file.  if this argument is supplied then the named file _must_ contain all of the 
      sequences for the genomic sequence features in the input GFF file, _except_ those that appear
      in the ##FASTA section of the GFF file.
  
  B<--dna_id_regex>
      optional.  regular expression used to parse the sequence unique id from FASTA deflines in 
      --dna_fasta and the FASTA section of the GFF file itself.  in the latter case, the regular 
      expression must NOT match any non-peptide ids, otherwise --dna_id_prefix and --dna_id_suffix 
      may be misapplied..   default = ^>(\S+)
  
  B<--dna_id_prefix>
      optional. prefix to prepend to the id parsed by --dna_id_regex to produce the sequence ID 
      used by the corresponding GFF feature.
  
  B<--dna_id_suffix>
      optional. suffix to append to the id parsed by --dna_id_regex to produce the sequence ID 
      used by the corresponding GFF feature.
  
  B<--dna_no_seqdata>
      do not create Seq-data or Seq-data-import entries for the DNA/reference sequences; use --dna_fasta,
      if specified, or the sequences present in the GFF file, only to determine the sequence length(s).
  
  B<--gene_type>
      optional.  specifies a SO type in the input GFF file that should be replaced with "gene".  this can
      be used to handle nonstandard inputs in which, for example, the term "match" is used as the parent
      of one or more CDS features (e.g., as in GeneWise GFF output)  Note that the SO types _are_
      case-sensitive.
  
  B<--organism_genetic_code>
      optional.  specifies a genetic code value to appear in the BSML <Organism> element for --organism
      see http://www.ncbi.nlm.nih.gov/Taxonomy/Utils/wprintgc.cgi?mode=c#SG1 for values
  
  B<--organism_mt_genetic_code>
      optional.  specifies a mitochondrial genetic code value to appear in the BSML <Organism> element 
      for --organism.  see http://www.ncbi.nlm.nih.gov/Taxonomy/Utils/wprintgc.cgi?mode=c#SG1 for values
  
  B<--output, -o>
      output BSML file (which should not exist before running the script.)
  
  B<--project, -p>
      project/database name used to create unique feature identifiers.
  
  B<--id_repository, -i>
      path to the Ergatis project_id_repository for the current project.
  
  B<--organism, -r>
      organism to place in the BSML <Genomes> section.  the first word will be used as the BSML genus,
      and the rest of the string will be placed in the BSML species attribute.
  
  B<--use_cds_parent_ids,-c>
      optional.  whether to use the GFF parent id to identify CDS features that lack an ID of their own.
  
  B<--insert_missing_mrnas>
      optional.  automatically insert missing mRNA features wherever they are missing from the GFF 
      (i.e., anytime a CDS feature is found hanging directly off a gene feature)
      
  B<--insert_missing_exons>
      optional.  automatically inserts missing exon features in any gene model that does not have _any_
      exons but does have CDS features.  in this case a single exon will be created to exactly span each
      CDS.
  
  B<--insert_polypeptides>
      optional.  automatically inserts a polypeptide feature in any gene model that has one or more CDS
      features but no polypeptide feature.
  
  B<--inserted_polypeptide_id_type>
      optional. specifies which feature ('CDS', 'gene', 'transcript', or 'mRNA') the newly-inserted
      polypeptide ids should be based on (default = 'gene')  the id of the new polypeptide will be 
      formed by taking the GFF id of the corresponding named feature and appending "-Protein"  
      Note that "transcript" and "mRNA" are synonymous for the purposes of this option.
  
  B<--default_seq_class,-e>
      optional.  default sequence class/SO type (e.g., 'assembly', 'supercontig') to use for sequences 
      for which the type cannot be parsed from the GFF file.
  
  B<--default_seq_attributes,-e>
      optional.  comma-delimited list of BSML attributes (in colon-delimited key:value form) to associate
      with each genomic sequence in the GFF file.
  
  B<--feat_attribute_mappings>
      optional.  a comma-delimited list of GFF attribute -> BSML Attribute mappings, each of which is
      defined by a source (GFF) attribute name and a target (BSML) attribute name, separated by a colon,
      for example "Name:gene_product_name" will take each BSML 'Name' value and insert it into the 
      BSML document as an <Attribute> with name="Name" and content=the corresponding GFF attribute value.
      Any embedded colons may be escaped with a backslash ("\:")
  
  B<--clone_feat_attribute_mappings>
      optional.  a comma-delimited list of colon-separated values.  each member of the list is a colon-
      separated triplet that contains 1. a source SOFA type, 2. a BSML attribute name, and 3. a target 
      SOFA type.  e.g., "gene:gene_product_name:CDS,gene:gene_product_name:transcript"  This particular
      example specifies that--within each gene model/feature group--any gene_product_name BSML Attributes
      attached to the gene feature will be copied over to the associated transcript and CDS features
      (without introducing duplicate attribute values).  This cloning/copying is done _after_ any applicable 
      --feat_attribute_mappings have been processed for all of the involved features.
  
  B<--feat_xref_mappings,-x>
      optional.  a comma-delimited list of GFF attribute -> BSML Cross-reference mappings, each of which
      is defined by a set of 3 values separated by colons, as in 'ID:mydb:accession', which specifies
      that each BSML 'ID' value should be inserted into the BSML document as a <Cross-reference> 
      element with database="mydb" and identifier-type="accession" (and identifier set to the ID value.)
      Any embedded colons may be escaped with a backslash ("\:")
    
  B<--clone_feat_xref_mappings>
      optional.  behaves similarly to --clone_feat_attribute_mappings, but copying BSML <Cross-references>
      instead of <Attributes>
  
  B<--seq_xref_mappings>
      optional.  identical to --xref_mappings except that it defines cross-reference mappings for the 
      reference _sequences_ in the GFF files (i.e., those things whose IDs appear in GFF column 1)
      in the case where the sequences are not themselves defined as GFF features the only attribute for
      which a mapping may be specified is 'ID'.
  
  B<--atts_with_unescaped_commas>
      optional.  a comma-delimited list of GFF3 attributes whose values (incorrectly) contain unescaped
      commas.  instead of parsing these values as comma-delimited lists the program will treat each as
      a single value and will parse it as though the commas embedded in the value had been correctly 
      URL-escaped.
  
  B<--allow_genes_with_no_cds>
      optional.  normally the script expects that any non-protein-coding gene will either: 1. be assigned
      an explicit SO type of 'pseudogene' instead of 'gene' or 2. have a non-coding RNA SO type at the
      transcript level (e.g., ncRNA, tRNA, etc.)  therefore if the script is running with --insert_polypeptides
      and finds a gene for which neither of these things are true, it will fail with an error if the gene
      lacks a CDS.  use this flag to permit the conversion to continue with a warning instead.
  
  B<--sofa_type_mappings>
      optional.  a comma-delimited list of SOFA id or name mappings, in the form id1=>id2 or name1=>name2.
      each occurrence of id1 or name1 in the GFF3 SOFA feature type column (GFF3 column #3) will be
      replaced by id2/name2 prior to performing any subsequent parsing.  this option can be useful for
      making a GFF3 file more closely match the canonical gene encoding.  for example, if a GFF3 file
      uses the term "ORF" instead of "gene" it can be rectified by specifying
      --sofa_type_mappings='ORF=>gene'
  
  B<--log,-l>
      optional.  path to a log file the script should create.  will be overwritten if
      it already exists.
  
  B<--debug,-d>
      optional.  the debug level for the logger (an integer)
  
  B<--help,-h>
      print usage/help documentation
  
  B<--man,-m>
      print detailed usage/help documentation
  
  =head1 DESCRIPTION
  
  This script parses a single GFF input file containing annotation data (for one or more
  genomic sequences) and writes it out as a BSML document that can be subsequently fed 
  into bsml2chado to load it into a Chado database.  This script was originally created 
  by copying and then generalizing Brett Whitty's evmgff32bsml.pl utility.
  
  =head1 INPUT
  
  A single GFF input file.  See the GFF documentation for more details.  Note that the
  script has a number of options that allow it to correctly parse/convert a variety of
  GFF-format files, even those that may deviate from the official specification in one
  way or another.
  
  =head1 OUTPUT
  
  A single BSML document.  See the BSML documentation for more details.
  
  =head1 CONTACT
  
      Jonathan Crabtree
      jonathancrabtree@gmail.com
