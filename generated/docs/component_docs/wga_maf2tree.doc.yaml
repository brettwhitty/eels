---
# Ergatis Component Documentation
# Extracted from source by extract_component_docs.pl
# Source: TIGR/JCVI/IGS Ergatis bioinformatics workflow system
#
# This file preserves ALL documentation, comments, parameter descriptions,
# and structural details from the original Ergatis source files.

component: wga_maf2tree
extracted_at: "2026-02-19T15:39:25"
source_files:
  - wga_maf2tree.config
  - wga_maf2tree.xml

# Configuration file - all sections, parameters, defaults, and inline comments
config:
  interface:
    classification: phylogeny
  input:
    MAF_FILE: ""
    FASTA_FILE: ""
  output:
    OUTPUT_TOKEN: default
    OUTPUT_DIRECTORY: $;REPOSITORY_ROOT$;/output_repository/$;COMPONENT_NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    OUTPUT_TREE_FILE: $;OUTPUT_REPOSITORY$;/full_genome.tree
  component:
    COMPONENT_NAME: wga_maf2tree
    DESCRIPTION: Take a whole genome alignment maf file and make a tree (uses phylomark)
    WORKFLOW_REPOSITORY: $;REPOSITORY_ROOT$;/workflow/runtime/$;COMPONENT_NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    PIPELINE_TOKEN: unnamed
    # The version,revision,tag here is set by an interpolated CVS tag
    VERSION: $Name$
    RELEASE_TAG: $Name$
    REVISION: "$Revision: 5801 $"
    TEMPLATE_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.xml
    # the following keys are replaced at runtime by the invocation script
    COMPONENT_CONFIG: ""
    COMPONENT_XML: ""
    PIPELINE_XML: ""
    PIPELINEID: ""
  include:
    PROJECT_CONFIG: ""

# Main workflow XML template - step definitions
workflow_xml:
  xml_comments:
    - Preprocessing
    - Processing
    - Mugsy will append the genome name (fasta file basename) before the sequence ids in the maf. This will fix that
    - Create a directory for all the fasta files to be split into
    - Split the fasta into individual files
    - Run phylomark prep
    - Rename the output file
    - Create svg and pdf files for the tree
  command_sets:
    - wga_maf2tree workflow
  steps:
    - name: create output directory
      type: RunUnixCommand
      executable: mkdir
      arg: -p -m 777 $;OUTPUT_DIRECTORY$;
    - name: create temp directory
      type: RunUnixCommand
      executable: mkdir
      arg: -p -m 777 $;TMP_DIR$;
    - name: fix maf
      type: RunUnixCommand
      executable: "perl -ne 's/^s\\s+[^\\.]+\\.(\\S+)/s $1/;print'"
      params:
        - key: stdin
          value: $;MAF_FILE$;
        - key: stdout
          value: $;OUTPUT_DIRECTORY$;/fixed.maf
    - name: create fasta dir
      type: RunUnixCommand
      executable: mkdir
      arg: -p -m 777 $;TMP_DIR$;/fasta
    - name: create fasta dir
      type: RunUnixCommand
      executable: /usr/bin/perl
      arg: "-0777 -ne '@f = split(/\\n&gt;/); for $fsa (@f){$fsa=~s/^&gt;//;$n=$1 if($fsa=~/^(\\S+)/); open(O,\"&gt;$;TMP_DIR$;/fasta/$n.fsa\");print O \"&gt;\".$fsa.\"\\n\";close(O); print \"$n.fsa\\n\";}'"
      params:
        - key: stdin
          value: $;FASTA_FILE$;
    - name: create tree
      type: RunUnixCommand
      executable: cd $;OUTPUT_DIRECTORY$;;source $;PHYLOMARK_DIR$;/phylomark_env.sh;$;PHYLOMARK_DIR$;/Phylomark_prep.py
      params:
        - key: --input-maf
          value: $;MAF_FILE$;
        - key: --fasta-dir
          value: $;TMP_DIR$;/fasta
        - key: --tmp-dir
          value: $;TMP_DIR$;
    - name: Move file
      type: RunUnixCommand
      executable: /bin/mv
      arg: $;OUTPUT_DIRECTORY$;/wga.tree $;OUTPUT_TREE_FILE$;
    - name: Convert newick tree to svg
      type: RunUnixCommand
      executable: $;NEWICK_UTILITIES$;/nw_display
      arg: "-s -w 950 -b 'opacity:0' -l 'font-size:large' $;OUTPUT_TREE_FILE$; > $;OUTPUT_TREE_FILE$;.svg"
    - name: Convert newick tree to pdf
      type: RunUnixCommand
      executable: $;RASTERIZER_PATH$;
      arg: $;OUTPUT_TREE_FILE$;.svg pdf 1000 1000
