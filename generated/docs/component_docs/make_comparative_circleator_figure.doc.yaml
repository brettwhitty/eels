---
# Ergatis Component Documentation
# Extracted from source by extract_component_docs.pl
# Source: TIGR/JCVI/IGS Ergatis bioinformatics workflow system
#
# This file preserves ALL documentation, comments, parameter descriptions,
# and structural details from the original Ergatis source files.

component: make_comparative_circleator_figure
extracted_at: "2026-02-19T15:39:25"
source_files:
  - make_comparative_circleator_figure.config
  - make_comparative_circleator_figure.xml
  - make_comparative_circleator_figure.i1.xml

# Configuration file - all sections, parameters, defaults, and inline comments
config:
  interface:
    classification: utility
  parameter:
    # Optional.Comma-separated list of desired output formats for the circleator figure (pdf, jpg, png). Default is pdf,jpg
    OUTPUT_FORMAT: ""
    # Optional.Height of the figure. Default is 3000
    OUTPUT_HEIGHT: ""
    # Optional.Width of the figure. Default is 3000
    OUTPUT_WIDTH: ""
  input:
    # Path to list of GenBank files
    GENBANK_LIST: ""
    # Path to file containing SNPs for all the compared genomes 
    SNP_FILE: ""
    # Path to gene summary file
    INPUT_FILE: ""
    # Path to list of gene summary files
    INPUT_FILE_LIST: ""
    # Path to directory containing gene summary files
    INPUT_DIRECTORY: ""
    # the following is only used when iterating over an INPUT_DIRECTORY
    INPUT_EXTENSION: gene_summary.txt
  output:
    OUTPUT_TOKEN: default
    OUTPUT_DIRECTORY: $;REPOSITORY_ROOT$;/output_repository/$;COMPONENT_NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    SVG_LIST: $;OUTPUT_DIRECTORY$;/$;COMPONENT_NAME$;.svg.list
    PDF_LIST: $;OUTPUT_DIRECTORY$;/$;COMPONENT_NAME$;.pdf.list
    PNG_LIST: $;OUTPUT_DIRECTORY$;/$;COMPONENT_NAME$;.png.list
  component:
    COMPONENT_NAME: make_comparative_circleator_figure
    DESCRIPTION: none
    WORKFLOW_REPOSITORY: $;REPOSITORY_ROOT$;/workflow/runtime/$;COMPONENT_NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    PIPELINE_TOKEN: unnamed
    # The version,revision,tag here is set by an interpolated CVS tag
    VERSION: 2.0
    RELEASE_TAG: $Name$
    REVISION: "$Revision: 6048 $"
    TEMPLATE_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.xml
    ITERATOR1: i1
    ITERATOR1_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.$;ITERATOR1$;.xml
    # Distributed options
    GROUP_COUNT: 150
    NODISTRIB: 0
    # the following keys are replaced at runtime by the invocation script
    COMPONENT_CONFIG: ""
    COMPONENT_XML: ""
    PIPELINE_XML: ""
    PIPELINEID: ""
  include:
    PROJECT_CONFIG: ""

# Main workflow XML template - step definitions
workflow_xml:
  xml_comments:
    - Iterator
    - Postprocessing
  command_sets:
    - make comparative circleator figures
  includes:
    - "file=\"$;DOCS_DIR$;/file_iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=ITERATOR1,$;ITERATOR_XML$;=ITERATOR1_XML\""
  steps:
    - name: create output directory
      type: RunUnixCommand
      executable: mkdir
      arg: -p -m 777 $;OUTPUT_DIRECTORY$;
    - name: create temp directory
      type: RunUnixCommand
      executable: mkdir
      arg: -p -m 777 $;TMP_DIR$;
    - name: create svg file list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/create_list_file
      params:
        - key: --directory
          value: $;OUTPUT_DIRECTORY$;
        - key: --regex
          value: "\".*\\.svg\""
        - key: --output_list
          value: $;SVG_LIST$;
    - name: create pdf file list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/create_list_file
      params:
        - key: --directory
          value: $;OUTPUT_DIRECTORY$;
        - key: --regex
          value: "\".*\\.pdf\""
        - key: --output_list
          value: $;PDF_LIST$;
    - name: create png file list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/create_list_file
      params:
        - key: --directory
          value: $;OUTPUT_DIRECTORY$;
        - key: --regex
          value: "\".*\\.png\""
        - key: --output_list
          value: $;PNG_LIST$;

# Iterator i1 - per-input processing steps
iterator_i1:
  command_sets:
    - create comparative circleator figure
  steps:
    - name: remove_non_unique_snps
      type: RunUnixCommand
      executable: $;BIN_DIR$;/remove_nonunique_snps
      params:
        - key: --snp_file
          value: $;SNP_FILE$;
        - key: --reference
          value: $;I_FILE_BASE$;
        - key: stdout
          value: $;OUTPUT_DIRECTORY$;/$;ITERATOR_NAME$;/g$;GROUP_NUMBER$;/$;I_FILE_BASE$;_filtered_snps.txt
        - key: stderr
          value: $;TMP_DIR$;/$;ITERATOR_NAME$;/g$;GROUP_NUMBER$;/$;COMPONENT_NAME$;_$;I_FILE_BASE$;_rm_nonuniq_snps.stderr
    - name: make_comparative_circleator_figure
      type: RunUnixCommand
      executable: $;BIN_DIR$;/make_comparative_circleator_figure
      params:
        - key: --circleator_path
          value: $;CIRCLEATOR_PATH$;
        - key: --rasterizer_path
          value: $;RASTERIZER_PATH$;
        - key: --gb_list_file
          value: $;GENBANK_LIST$;
        - key: --gene_summary_file
          value: $;I_FILE_PATH$;
        - key: --snp_file
          value: $;OUTPUT_DIRECTORY$;/$;ITERATOR_NAME$;/g$;GROUP_NUMBER$;/$;I_FILE_BASE$;_filtered_snps.txt
        - key: --svg_file
          value: $;I_FILE_BASE$;
        - key: --output_dir
          value: $;OUTPUT_DIRECTORY$;/$;ITERATOR_NAME$;/g$;GROUP_NUMBER$;
        - key: --output_formats
          value: $;OUTPUT_FORMAT$;
        - key: --output_width
          value: $;OUTPUT_WIDTH$;
        - key: --output_height
          value: $;OUTPUT_HEIGHT$;
        - key: stdout
          value: $;TMP_DIR$;/$;ITERATOR_NAME$;/g$;GROUP_NUMBER$;/$;COMPONENT_NAME$;_$;I_FILE_BASE$;.stdout
        - key: stderr
          value: $;TMP_DIR$;/$;ITERATOR_NAME$;/g$;GROUP_NUMBER$;/$;COMPONENT_NAME$;_$;I_FILE_BASE$;.stderr

# Perl script documentation (POD)
perl_scripts:
  - script: create_list_file.pl
    pod: |
  =head1	NAME
  
  create_list_file.pl - script to create a list of files given a certain regex
  
  =head1	SYNOPSIS
  
  USAGE: create_list_file.pl
         [  --directory|d=/path/to/some/directory/
            --output_list|o=/path/output.list
            --regex|r=string regular expression
            --include_gz|g ]
  
  =head1	OPTIONS
  
  B<--directory,-d>
  	Location of the directory to search.  No wild card characters should be
      used in the directory.
      (Default: current directory)
  
  B<--output_list,-o>
      File that will be the list of found files
      (Default: standard out)
  
  B<--regex,-r>
      Regular expression for entire file name (including full path)
      (Default: finds all files)
  
  B<--include_gz|g>
      This flag tells the script to include .gz extensions in the list
  
  B<--help,-h>
  	Prints this help message
  
  =head1	DESCRIPTION
  
      This script will search a directory for file names containing the given
      regular expression.  By default, all .gz or .gzip extensions are stripped
      off.  Programs using these list files should know to search for .gz|.gzip
      versions.
  
      **Note: No wild card characters should be used in this option.
  
  =head1	INPUT
  
      There are no required options to the script and there isn't really any
      input.  See above for defaults.  
  
  =head1	OUTPUT
  
      The script will output a list of files that match the regular expression
      given by option --regex|-r. If no output file is given, this script will 
      print out to standard out.  
  
  =head1	CONTACT
  
      Kevin Galens
      kgalens@tigr.org
  - script: remove_nonunique_snps.pl
    pod: |
  =head1  NAME 
  
  remove-nonunique-clovr-comparative-snps.pl - Remove all SNPs from a CloVR-Comparative SNP file _except_ those unique to a specified reference.
  
  =head1 SYNOPSIS
  
  remove-nonunique-clovr-comparative-snps.pl
           --snp_file=somefile_mini.snps
           --reference=Bordetella_holmesii_41130_BH003
          [--help
           --man]
  
  =head1 OPTIONS
  
  B<--snp_file,-s>
      Path to a SNP output file prodcued by an instance of the CloVR-Comparative ergatis pipeline.
  
  B<--reference,-r>
      The reference genome/taxon: only SNPs unique to this genome will be retained in the output.
  
  B<--help,-h> 
      Display the script documentation.
  
  B<--man,-m>
      Display the script documentation.
  
  =head1 DESCRIPTION
  
  Remove all SNPs from a CloVR-Comparative SNP file _except_ those
  unique to a specified reference.  Used by the CloVR-Comparative
  pipeline to reduce the size of the input SNP file before parsing it
  and converting it to the space-inefficient BioPerl representation.
  
  =head1 INPUT
  
  The SNP output file prodcued by an instance of the CloVR-Comparative ergatis pipeline.
  
  =head1 OUTPUT
  
  The same SNP file but with all SNPs not unique to the given reference taxon removed.
  
  =head1 CONTACT
  
      Jonathan Crabtree
      jonathancrabtree@gmail.com
  - script: make_comparative_circleator_figure.pl
    pod: |
  =head1  NAME 
  
  make-clovr-comparative-circleator-figure.pl - Automatically generate and rasterize a Circleator figure given GenBank format input file(s).
  
  =head1 SYNOPSIS
  
  make-clovr-comparative-circleator-figure.pl
           --circleator_path=/usr/local/packages/circleator/bin/circleator
           --rasterizer_path=/usr/local/packages/circleator/bin/rasterize-svg
           --gb_list_file=genbank.list
           --gene_summary_file=clovr_gene_summary.txt
           --snp_file=somefile_mini.snps
          [--svg_file=figure.svg
           --output_dir=.
           --output_formats='pdf,jpg'
           --output_width=3000
           --output_height=3000
           --help
           --man]
  
  =head1 OPTIONS
  
  B<--gb_list_file,-l>
      Path to the file used in the INPUT_FILE_LIST parameter of the second step (genbank2bsml.default)
      of the CloVR comparative pipeline. The gb_list_file lists the paths to the GenBank files (one
      per line) used as input to the comparative pipeline.
  
  B<--gene_summary_file,-g>
      Path to one of the gene summary files produced by the CloVR comparative pipeline.
  
  B<--snp_file>
      Path to the SNP file produced by the CloVR comparative pipeline.
  
  B<--circleator_path>
      Path to the "circleator" script in the bin/ directory of the Circleator distribution.
  
  B<--rasterizer_path>
      Path to the "rasterize-svg" script in the bin/ directory of the Circleator distribution.
  
  B<--svg_file,-s>
      Optional. Name of the SVG file to generate in --output_dir. Default is "figure.svg"
  
  B<--output_dir>
      Optional. Path to the directory in which the contig list file, Circleator configuration file,
      output SVG file, and rasterized file(s) should be written. Default is current working directory.
  
  B<--output_formats>
      Optional. Comma-delimited list of formats ('png', 'jpg', or 'pdf') to which SVG should 
      be rasterized/converted. Default is 'pdf,jpg'
  
  B<--output_width>
      Optional. Width of the final rasterized/converted images. Default is 3000.
  
  B<--output_height>
      Optional. Height of the final rasterized/converted images. Default is 3000.
  
  B<--help,-h> 
      Display the script documentation.
  
  B<--man,-m>
      Display the script documentation.
  
  =head1 DESCRIPTION
  
  This is a wrapper script for Circleator that performs the following tasks:
  
  1. Parses the CloVR-comparative gene summary file specified by --gene_summary_file.
  2. Identifies the set of GenBank files that correspond to the reference genes in --gene_summary_file
  3. Creates a Circleator --contig_list file for all of the GenBank files identified in the previous step.
  4. Converts the gene cluster information in --gene_summary_file into a standard Circleator format.
  5. Creates a custom Circleator configuration file that displays:
    a. The reference genes (forward and reverse strand)
    b. The "core" genes (those present in all strains according to the gene clusters)
    c. The unique genes (those present only in the reference strain according to the gene clusters)
    d. The unique SNPs (positions where the reference differs from _all_ of the other strains)
  6. Runs the Circleator to generate an SVG-format figure
  7. Runs the SVG rasterizer to convert the SVG file into PDF, PNG, or JPEG
  
  =head1 INPUT
  
  The following input and output files from an instance of the CloVR-Comparative ergatis pipeline:
   o the INPUT_FILE_LIST of the genbank2bsml.default component
     i.e., a list of GenBank files
   o one of the gene summary files produced by the pipeline
   o the SNP output file produced by the pipeline
  
  =head1 OUTPUT
  
  A graphical plot of the input sequence(s) in both SVG format and whatever format is specified
  by the --output_format option.
  
  =head1 CONTACT
  
      Jonathan Crabtree
      jonathancrabtree@gmail.com
