---
# Ergatis Component Documentation
# Extracted from source by extract_component_docs.pl
# Source: TIGR/JCVI/IGS Ergatis bioinformatics workflow system
#
# This file preserves ALL documentation, comments, parameter descriptions,
# and structural details from the original Ergatis source files.

component: start_site_curation
extracted_at: "2026-02-19T15:34:47"
source_files:
  - start_site_curation.config
  - start_site_curation.xml
  - start_site_curation.i1.xml
  - component_docs/start_site_curation.tmpl

# Component documentation (from Ergatis web UI help template)
component_documentation: |
  <!-- component documentation -->
  
  <h3>Overview</h3>
  <p>
      start_site_curation.pl - Looks at the start sites of genes in a bsml file and will
      move the start site based on alignment evidence
  </p>
  
  <h3>Description</h3>
  <p>
      A voting based start site curation algorithm.  The algorithm uses evidence generated
      by BER alignments, as well as taking into consideration ribosomal binding sites
      (shine delgarno consensus sequence) as well as start site probabilities.  Reads gene
      information from gene describing BSML input (such as that output from promote_gene_prediction
      or glimmer3) and also evidence (a list of BSML output files from BER alignment run).  
  
      A start site will be changed according to the following algorithm:
  
      1. BER Evidence
         - All alignments not passing the percent_identity and p_value cutoffs are eliminated
         - Any alignment which begins at a start site within the query sequence gets a vote
         - A bonus is added if the subject sequence is a characterized protein (characterized_
           vote_bonus).
         - The start site with the highest number of votes is chosen as new start if the
           number of votes is greater than or equal to the min_vote_cutoff.  If there is a 
           tie (i.e. two start sites with the same vote count):
      2. Ribosomal Binding Site
         - The sequence upstream of the start site is searched (20 nucleotides upstream
           to 5 nucleotides upstream [coords -20 -> -5 relative to start site] ).
         - Lengths of sequences of size sliding_window_size are measured for AG content. If
           the AG percentage is greater than or equal to the percent_ag_cutoff, the start
           site is considered to have an RBS and is given one vote.
      3. Start Site probabilities
         - The occurence of all the start sites is counted and the relative frequencies are
           calculated.  The relative frequency is added to the vote total.  This will never be
           greater than one vote, and therefore will only be useful in deciding ties at this 
           point.
  </p>
  <h3>Input</h3>
  <p>
      Input is a gene describing bsml document.  It should contain a Sequence element 
      representing the genomic sequence with Feature children representing the genes.
      Each gene should have a Feature element of class polypeptide, CDS, gene, transcript,
      and exon and their relationships should be described with Feature-groups.  The Sequence
      element must also have a Seq-data-import linking to fasta.  Attributes of the Sequence
      element that are exptected are:
        Sequence[@molecule]
        Sequence[@class]
        Sequence[@id]
  
      Ids for the Feature elements are assumed to be generated by Ergatis::IdGenerator and
      in the format proj.feature_type.12345.1 . 
  
      The BER evidence input is a list of BER bsml files which are generated using the 
      ergatis component.  The BSML is formatted as our standard usage for alignment
      analyses.  
  
  </p>
  
  <h3>Output</h3>
  <p>
      The output is a gene describing bsml document.  The version number on the genes and
      related features where start site changes have occurred are incremented to indicate 
      a new version of the gene.  
  
      The script can print two sets of bsml files.  The first set includes the all genes
      and is representative of the working models for the sequence.  The second set is a 
      collection of bsml files which only list the genes which have changed.  The second
      set bsml files (only changed features) is optional and will not be printed if the 
      --changed_features_bsml option is not used.
  </p>
  
  <h3>Options</h3>
  <p>
  --ber_extension,-b
      OPTIONAL. Default = 300.  The number of nucleotides used in the ber extension
  
  --percent_identity_cutoff,-p
      OPTIONAL. Default = 60.  The percent identity of BER hits.  Filter out
      all those hits with a lower percent_identity.
  
  --p_value_cutoff,-P
      OPTIONAL. Default = 1e-30.  The p_value cutoff for BER alignments.
  
  --characterized_vote_bonus,-C
      OPTIONAL. Default = 4.  The bonus number of votes a start site will receive when 
      confirmed by a characterized protein. (1 non-characterized match = 1 vote)
  
  --min_vote_cutoff,-m
      OPTIONAL. Default = 2.  The number of votes a start_site should receive before being
      considered. Basically, gives a bonus to current start sites.
  
  --rbs_sliding_window_size,-r
      OPTIONAL. Default = 6.  The window size over which percent AG is calculated when
      searching for ribosomal binding site.
  
  --rbs_ag_percent_cutoff,-a
      OPTIONAL. Default = 75.  The percent presence of As and Gs in the sliding window. If
      percent AG is higher than this cutoff, the sequence is considered to have a RBS.
  </p>

# Configuration file - all sections, parameters, defaults, and inline comments
config:
  interface:
    classification: functional prediction
  parameters:
    # BER evidence list
    BER_EVIDENCE: ""
    # File based database of characterized proteins
    CHARACTERIZED_DB: $;CHAR_DB$;
    # Can use a database instead of file based database
    # but you need to enter a username and password
    DB_USERNAME: ""
    DB_PASSWORD: ""
    # Path to coding_hmm.lib.db file (to lookup
    # cutoff scores)
    HMM_CODING_DB: $;HMM_LIB_DB$;
    # The extension (in nucleotides) used in BER
    BER_EXTENSION: 300
    # Ber Percent Identity cutoff
    PERCENT_IDENTITY_CUTOFF: 60
    # p-value cutoff
    P_VALUE_CUTOFF: 1e-30
    # Bonus votes for characterized protein matches
    CHARACTERIZED_VOTE_BONUS: 4
    # If a start site has fewer votes than this parameter, it will
    # not be considered (the higher this paramter, the more likely
    # NOT to change a start site from the original).
    MIN_VOTE_CUTOFF: 2
    # The window size used to find ribosome binding sites
    RBS_SLIDING_WINDOW_SIZE: 6
    # Percent AG of sliding window needed to call an RBS
    RBS_AG_PERCENT_CUTOFF: 75
    # The BSML Input File
    # Should be gene describing bsml
    BSML_INPUT_FILE: ""
    BSML_INPUT_LIST: ""
  input:
    INPUT_FILE_LIST: $;OUTPUT_DIRECTORY$;/$;COMPONENT_NAME$;.each.bsml.list
    INPUT_FILE: ""
    INPUT_DIRECTORY: ""
    # the following is only used when iterating over an INPUT_DIRECTORY
    INPUT_EXTENSION: fsa
  output:
    OUTPUT_TOKEN: default
    OUTPUT_DIRECTORY: $;REPOSITORY_ROOT$;/output_repository/$;COMPONENT_NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    BSML_OUTPUT_LIST: $;OUTPUT_DIRECTORY$;/$;COMPONENT_NAME$;.bsml.list
    ONLY_CHANGED_BSML_OUTPUT_LIST: $;OUTPUT_DIRECTORY$;/$;COMPONENT_NAME$;.changed.bsml.list
    ALL_BSML_LIST: $;OUTPUT_DIRECTORY$;/$;COMPONENT_NAME$;.each.bsml.list
  component:
    COMPONENT_NAME: start_site_curation
    DESCRIPTION: none
    WORKFLOW_REPOSITORY: $;REPOSITORY_ROOT$;/workflow/runtime/$;COMPONENT_NAME$;/$;PIPELINEID$;_$;OUTPUT_TOKEN$;
    PIPELINE_TOKEN: unnamed
    # The version,revision,tag here is set by an interpolated CVS tag
    VERSION: 2.0
    RELEASE_TAG: $Name$
    REVISION: "$Revision: 4680 $"
    TEMPLATE_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.xml
    ITERATOR1: i1
    ITERATOR1_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.$;ITERATOR1$;.xml
    ITERATOR2: i2
    ITERATOR2_XML: $;DOCS_DIR$;/$;COMPONENT_NAME$;.$;ITERATOR2$;.xml
    # Distributed options
    GROUP_COUNT: 150
    NODISTRIB: 0
    # the following keys are replaced at runtime by the invocation script
    COMPONENT_CONFIG: ""
    COMPONENT_XML: ""
    PIPELINE_XML: ""
    PIPELINEID: ""
  include:
    PROJECT_CONFIG: ""

# Main workflow XML template - step definitions
workflow_xml:
  xml_comments:
    - Preprocessing
    - Iterator
  command_sets:
    - start_site_curation workflow
    - analyze overlaps
  includes:
    - "file=\"$;DOCS_DIR$;/file_iterator_template.xml\" keys=\"$;ITERATOR_NAME$;=ITERATOR1,$;ITERATOR_XML$;=ITERATOR1_XML\""
  steps:
    - name: create output directory
      type: RunUnixCommand
      executable: mkdir
      arg: -p -m 777 $;OUTPUT_DIRECTORY$;
    - name: create temp directory
      type: RunUnixCommand
      executable: mkdir
      arg: -p -m 777 $;TMP_DIR$;
    - name: replace template keys
      type: RunUnixCommand
      executable: $;BIN_DIR$;/replace_template_keys
      params:
        - key: --template_xml
          value: $;DOCS_DIR$;/start_site_curation_distributed.xml
        - key: --component_conf
          value: $;COMPONENT_CONFIG$;
        - key: --output_xml
          value: $;WORKFLOW_REPOSITORY$;/start_site_curation_distributed.xml
        - key: --distribopts
          value: nodistrib=$;NODISTRIB$;
        - key: stdout
          value: $;TMP_DIR$;/replace_template_keys.stdout
        - key: stderr
          value: $;TMP_DIR$;/replace_template_keys.stderr
    - name: create all bsml list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/create_list_file
      params:
        - key: --directory
          value: $;OUTPUT_DIRECTORY$;
        - key: --regex
          value: "\".*all.bsml\""
        - key: --output_list
          value: $;BSML_OUTPUT_LIST$;
    - name: create changed bsml list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/create_list_file
      params:
        - key: --directory
          value: $;OUTPUT_DIRECTORY$;
        - key: --regex
          value: "\".*\\.changed.bsml\""
        - key: --output_list
          value: $;ONLY_CHANGED_BSML_OUTPUT_LIST$;
    - name: create changed bsml list
      type: RunUnixCommand
      executable: $;BIN_DIR$;/create_list_file
      params:
        - key: --directory
          value: $;OUTPUT_DIRECTORY$;
        - key: --regex
          value: "\".*\\.bsml\""
        - key: --output_list
          value: $;ALL_BSML_LIST$;

# Iterator i1 - per-input processing steps
iterator_i1:
  command_sets:
    - start_site_curation compute
  steps:
    - name: store config params
      type: RunUnixCommand
      executable: $;BIN_DIR$;/analysis2bsml
      params:
        - key: --ergatis_control_file
          value: $;ERGATIS_DIR$;.ini
        - key: --conf
          value: $;COMPONENT_CONFIG$;
        - key: --bsml_file
          value: $;I_FILE_PATH$;
        - key: --componenturl
          value: $;WORKFLOW_REPOSITORY$;/component.xml
        - key: --pipelineurl
          value: $;PIPELINE_XML$;
        - key: --analysis_id
          value: $;COMPONENT_NAME$;_analysis
    - name: dtd validation
      type: RunUnixCommand
      executable: $;BIN_DIR$;/dtdValid.pl
      arg: $;I_FILE_PATH$;
      params:
        - key: -d
          value: $;DOCS_DIR$;/bsml3_1.dtd

# Perl script documentation (POD)
perl_scripts:
  - script: create_list_file.pl
    pod: |
  =head1	NAME
  
  create_list_file.pl - script to create a list of files given a certain regex
  
  =head1	SYNOPSIS
  
  USAGE: create_list_file.pl
         [  --directory|d=/path/to/some/directory/
            --output_list|o=/path/output.list
            --regex|r=string regular expression
            --include_gz|g ]
  
  =head1	OPTIONS
  
  B<--directory,-d>
  	Location of the directory to search.  No wild card characters should be
      used in the directory.
      (Default: current directory)
  
  B<--output_list,-o>
      File that will be the list of found files
      (Default: standard out)
  
  B<--regex,-r>
      Regular expression for entire file name (including full path)
      (Default: finds all files)
  
  B<--include_gz|g>
      This flag tells the script to include .gz extensions in the list
  
  B<--help,-h>
  	Prints this help message
  
  =head1	DESCRIPTION
  
      This script will search a directory for file names containing the given
      regular expression.  By default, all .gz or .gzip extensions are stripped
      off.  Programs using these list files should know to search for .gz|.gzip
      versions.
  
      **Note: No wild card characters should be used in this option.
  
  =head1	INPUT
  
      There are no required options to the script and there isn't really any
      input.  See above for defaults.  
  
  =head1	OUTPUT
  
      The script will output a list of files that match the regular expression
      given by option --regex|-r. If no output file is given, this script will 
      print out to standard out.  
  
  =head1	CONTACT
  
      Kevin Galens
      kgalens@tigr.org
  - script: analysis2bsml.pl
    pod: |
  =head1  NAME 
  
  analysis2bsml.pl - add analysis parameters to a BSML result doc
  
  =head1 SYNOPSIS
  
      USAGE:  analysis2bsml.pl --bsml_file=/path/to/some/output.bsml 
                               --conf=/path/to/some/pipeline.config
                             [ --ergatis_control_file=/path/to/ergatis_install.ini ]
                             [ --componenturl=/path/to/some/pipeline.xml ]
                             [ --pipelineurl=/path/to/some/pipeline0.xml ]
                             [ --debug debug_level  ]
                             [ --log log_file ]
                             [ --analysis_id=some_id ]
  
  =head1 OPTIONS
  
  =item *
  
  B<--debug,-d> Debug level.  Use a large number to turn on verbose debugging. 
  
  =item *
  
  B<--analysis_id,-a> Analysis id (optional).  If given, will be the id attribute for the Analysis
  element created or appended to.  If the value 'first' is passed, the first Analysis element will
  be used.  If not given, the Analysis element will be created with no id attribute.
  
  =item *
  
  B<--log,-l> Log file
  
  =item *
  
  B<--help,-h> This help message
  
  =item *
  
  B<--ergatis_control_file,-e> Control file defining software versions for ergatis install.
  
  =item *
  
  B<--componenturl,-u> Stores component url in <Analysis>
  
  =item *
  
  B<--pipelineurl,-p> Store pipeline.xml url in <Analysis>
  
  =back
  
  =head1   DESCRIPTION
  
  This script is used to record the parameters of an analysis into the BSML file that the
  analysis created.  This is done to ensure that each of the run-time settings for the
  analysis are recorded for informational purposes or to re-run the analysis.
  - script: start_site_curation.pl
    pod: |
  =head1 NAME
  
  start_site_curation.pl - Looks at the start sites of genes in a bsml file and will
      move the start site based on alignment evidence
  
  =head1 SYNOPSIS
  
   USAGE: start_site_curation.pl
         --input_file=/path/to/some/glimmer3.bsml
         --input_list=/path/to/some/bsml.list
         --output_bsml=/path/to/output.all.bsml
         --evidence=/path/to/ber.bsml.list
         --char_db=/path/to/tchar.db
         --hmm_coding_db=/path/to/coding_hmm.lib.db
         --username=user
         --password=pass
         --ber_extension=300
         --percent_identity_cutoff=60
         --p_value_cutoff=1e-30
         --characterized_vote_bonus
         --min_vote_cutoff=3
         --rbs_sliding_window=4
         --rbs_ag_percent_cutoff=75
       [ --log=/path/to/file.log
         --debug=4
         --help
       ]
  
  =head1 OPTIONS
  
  B<--input_file,-i>
      Either --input_file or --input_list REQUIRED. Path to input gene describing bsml file.
  
  B<--input_list,-L>
      Either --input_file or --input_list REQUIRED. List file of BSML files.
  
  B<--output_directory,-o>
      REQUIRED. Path to output directory. 
  
  B<--evidence,-e>
      REQUIRED. BER evidence list for genes (bsml).
  
  B<--char_db,-c>
      OPTIONAL. Stored hash of characterized proteins. If not specified, will not score
      characterized proteins more
  
  B<--hmm_coding_db,-M>
      REQUIRED. Used to make sure that HMM matches pass cutoff scores.
  
  B<--ber_extension,-b>
      OPTIONAL. Default = 300.  The number of nucleotides used in the ber extension
  
  B<--percent_identity_cutoff,-p>
      OPTIONAL. Default = 60.  The percent identity of BER hits.  Filter out
      all those hits with a lower percent_identity.
  
  B<--p_value_cutoff,-P>
      OPTIONAL. Default = 1e-30.  The p_value cutoff for BER alignments.
  
  B<--characterized_vote_bonus,-C>
      OPTIONAL. Default = 4.  The bonus number of votes a start site will receive when 
      confirmed by a characterized protein. (1 non-characterized match = 1 vote)
  
  B<--min_vote_cutoff,-m>
      OPTIONAL. Default = 2.  The number of votes a start_site should receive before being
      considered. Basically, gives a bonus to current start sites.
  
  B<--rbs_sliding_window_size,-r>
      OPTIONAL. Default = 6.  The window size over which percent AG is calculated when
      searching for ribosomal binding site.
  
  B<--rbs_ag_percent_cutoff,-a>
      OPTIONAL. Default = 75.  The percent presence of As and Gs in the sliding window. If
      percent AG is higher than this cutoff, the sequence is considered to have a RBS.
  
  B<--username>
      Database username for querying for characterized status of proteins
  
  B<--password>
      Database password for querying for characterized status of proteins
  
  B<--log,-l>
      Logfile.
  
  B<--debug,-D>
      Debug level
  
  B<--help,-h>
      Print this message
  
  =head1  DESCRIPTION
  
      A voting based start site curation algorithm.  The algorithm uses evidence generated
      by BER alignments, as well as taking into consideration ribosomal binding sites
      (shine delgarno consensus sequence) as well as start site probabilities.  Reads gene
      information from gene describing BSML input (such as that output from promote_gene_prediction
      or glimmer3) and also evidence (a list of BSML output files from BER alignment run).  
  username
      A start site will be changed according to the following algorithm:
  
      1. BER Evidence
         - All alignments not passing the percent_identity and p_value cutoffs are eliminated
         - Any alignment which begins at a start site within the query sequence gets a vote
         - A bonus is added if the subject sequence is a characterized protein (characterized_
           vote_bonus).
         - The start site with the highest number of votes is chosen as new start if the
           number of votes is greater than or equal to the min_vote_cutoff.  If there is a 
           tie (i.e. two start sites with the same vote count):
      2. Ribosomal Binding Site
         - The sequence upstream of the start site is searched (20 nucleotides upstream
           to 5 nucleotides upstream [coords -20 -> -5 relative to start site] ).
         - Lengths of sequences of size sliding_window_size are measured for AG content. If
           the AG percentage is greater than or equal to the percent_ag_cutoff, the start
           site is considered to have an RBS and is given one vote.
      3. Start Site probabilities
         - The occurence of all the start sites is counted and the relative frequencies are
           calculated.  The relative frequency is added to the vote total.  This will never be
           greater than one vote, and therefore will only be useful in deciding ties at this 
           point.
      
  
  =head1  INPUT
  
      Input is a gene describing bsml document.  It should contain a Sequence element 
      representing the genomic sequence with Feature children representing the genes.
      Each gene should have a Feature element of class polypeptide, CDS, gene, transcript,
      and exon and their relationships should be described with Feature-groups.  The Sequence
      element must also have a Seq-data-import linking to fasta.  Attributes of the Sequence
      element that are exptected are:
        Sequence[@molecule]
        Sequence[@class]
        Sequence[@id]
  
      Ids for the Feature elements are assumed to be generated by Ergatis::IdGenerator and
      in the format proj.feature_type.12345.1 . 
  
      The BER evidence input is a list of BER bsml files which are generated using the 
      ergatis component.  The BSML is formatted as our standard usage for alignment
      analyses.  
  
  =head1 OUTPUT
      
      The output is a gene describing bsml document.  The version number on the genes and
      related features where start site changes have occurred are incremented to indicate 
      a new version of the gene.  
  
      The script can print two sets of bsml files.  The first set includes the all genes
      and is representative of the working models for the sequence.  The second set is a 
      collection of bsml files which only list the genes which have changed.  
  
  =head1  CONTACT
  
      Kevin Galens
      kgalens@som.umaryland.edu
